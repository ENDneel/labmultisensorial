{% extends "dashboard/base.html" %}
{% load static %}

{% block content %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<div id="layoutSidenav_content">

  <main>
    <div class="container-fluid">

      <script>
         
        $(document).ready(function () {
          //obtenemos el valor de los input
          var $crf_token = $('[name="csrfmiddlewaretoken"]').attr('value');
          var i = 1;
          
          $('#adicionar').click(function () {

            // var actividad = document.getElementById("actividad").value;
            var tiempo = document.getElementById("tiempo").value;
            var textoEscogido = document.getElementById("miSelect").options[document.getElementById("miSelect").selectedIndex].text 
            var actividad= textoEscogido
            if(tiempo.trim()!=""){
                 //contador para asignar id al boton que borrara la fila
            var fila = '<tr id="row' + i + '"><td>' + actividad + '</td><td>' + tiempo + '</td><td> <a id="' + i + '" name="remove" class="btn btn-danger me-md-2 btn_remove" type="button">  <i class="fas fa-trash-alt"></i>  Quitar</a> '; //esto seria lo que contendria la fila
            i++;
            console.log(i)
            $('#mytable tr:first').after(fila);
            $("#adicionados").text(""); //esta instruccion limpia el div adicioandos para que no se vayan acumulando
            var nFilas = $("#mytable tr").length;

            $("#adicionados").append(nFilas - 1);
            //le resto 1 para no contar la fila del header
            document.getElementById("tiempo").value = "";
            // document.getElementById("cedula").value = "";
            document.getElementById("actividad").value = "";
            document.getElementById("actividad").focus();
            }else{
              alert("El campo tiempo no es valido");
            }
          });
          console.log(i)
          $(document).on('click', '.btn_remove', function () {
            var button_id = $(this).attr("id");
            //cuando da click obtenemos el id del boton
            $('#row' + button_id + '').remove(); //borra la fila
            //limpia el para que vuelva a contar las filas de la tabla
            $("#adicionados").text("");
            var nFilas = $("#mytable tr").length;
            $("#adicionados").append(nFilas - 1);
          });
          $(document).on('click', '.btn_send', function () {
            if ($("#mytable tr").length==1) {
                $('#exampleModal2').modal('show');
            }else{
              $.ajax({
              type: "POST",
              url: "http://127.0.0.1:8000/Ses/sesion/",
              //url: "http://192.168.60.120:8000/Ses/sesion/",
              //url: "https://labmultisensorial.ups.edu.ec/Ses/sesion/",
              

              data: JSON.stringify({
                area: "Motricidad Gruesa",
                Estudiante: '{{ a }}'
              }),
              contentType: 'application/json; charset=utf-8',
              headers: { "X-CSRFToken": $crf_token },
              success: function (data) {
                $('#exampleModal').modal('show');
              },
              failure: function (data) {
                alert(data.responseText);
              },
              error: function (data) {
                alert(data.responseText);
              }
            });
            var tableHeaderRowCount = 1;
            var table = document.getElementById('mytable');
            console.log(table)
            var rowCount = table.rows.length;
            for (var i = tableHeaderRowCount; i < rowCount; i++) {
              table.deleteRow(tableHeaderRowCount);
            }

            }
            
          });

        });
      </script>

      <div class="row">
        <div class="container">
          <form>
            {% csrf_token %}

            <div class="form-group">
              <p>
                <label>Seleccione la Actividad:</label> <br>
                <select id="miSelect" name="miSelect" class="form-control" type="text"> 
                  <option value="0" selected>Sombrero 
                  <option value="1" >Broche 
                  <option value="2">Laberinto 
                  </select>
              </p>
              <p>
                <label>Ingrese el tiempo:</label> <br>
                <input id="tiempo" class="form-control" type="text"><br>
              </p>
              <!-- <p>
                <label>Entre su C&eacute;dula:</label> <br>
                <input id="cedula" class="form-control" type="text" placeholder="CedÃºla"> <br>
              </p> -->
              <button id="adicionar" class="btn btn-success" type="button">Agregar Actividad</button>
            </div>
          </form>

          <p>Elementos en la Tabla:
          <div id="adicionados"></div>
          </p>
          <table id="mytable" class="table table-bordered table-hover ">
            <tr>
              <th>Actividad</th>
              <th>Tiempo</th>
              <!-- <th>C&eacute;dula</th> -->
              <th>Eliminar</th>

            </tr>
          </table>
          <a name="send" class="btn btn-danger me-md-2 btn_send" type="button"> <i class="far fa-check-circle"></i>
            Iniciar</a></td>

        </div>
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Motricidad Gruesa Gruesa</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                Sesion creada Realice las activiades
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>
            </div>
          </div>

        </div>
        <div class="modal fade" id="exampleModal2" tabindex="-1" aria-labelledby="exampleModalLabel2" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel2">Motricidad Gruesa Gruesa</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
               Por favor Agrege activades 
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>
            </div>
          </div>

        </div>
      </div>
  </main>
</div>

{% endblock%}